<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
    body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; margin: 0; display: flex; justify-content: center; height: 100vh; color: #333; }
    .container { width: 100%; max-width: 700px; background: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    .header { background: #34495e; color: white; padding: 15px; text-align: center; }
    .content { flex-grow: 1; padding: 20px; overflow-y: auto; background: #f4f6f7; }
    .admin-row { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd; }
    input, select { padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; width: 100%; box-sizing: border-box; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
    .save-btn { background: #27ae60; color: white; padding: 15px; width: 100%; border: none; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>

<div class="container">
    <div id="login-view" style="padding:50px;">
        <h2 style="text-align:center">Admin Login</h2>
        <input type="password" id="admin-pass" placeholder="Password">
        <button onclick="adminLogin()" class="save-btn" style="margin-top:10px;">Login</button>
    </div>

    <div id="dashboard-view" style="display:none; flex-direction:column; height:100%;">
        <div class="header"><h2>Level Manager</h2></div>
        <div class="content" id="list-container"></div>
        <button class="save-btn" onclick="saveData()">Save Changes</button>
    </div>
</div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzIXt0QvCjg3iYDx4zL5gVODVeFBXW2jd12TFJzMKMWxL7iH4BD6Com16YxSRkvuHir/exec'; // <--- PASTE YOUR URL
    let currentPass = '';

    function adminLogin() {
        const pass = document.getElementById('admin-pass').value;
        fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'adminLoad', pass }) })
        .then(r => r.json()).then(d => {
            if(d.status === 'success') {
                currentPass = pass;
                document.getElementById('login-view').style.display = 'none';
                document.getElementById('dashboard-view').style.display = 'flex';
                renderList(d.data);
            } else alert("Invalid Password");
        });
    }

    function renderList(rows) {
        const c = document.getElementById('list-container');
        c.innerHTML = '';
        rows.forEach((r, i) => {
            // Mapping: 0:ID, 1:Q, 2-5:Opts, 6:Correct, 7:Active, 8:Game, 9:MediaType, 10:MediaContent
            c.innerHTML += `
            <div class="admin-row" id="row-${i}">
                <div style="display:flex; justify-content:space-between; font-weight:bold;">
                    <span>Level ${r[0]}</span>
                    <label><input type="checkbox" class="is-active" style="width:auto" ${r[7]?'checked':''}> Active</label>
                </div>
                <input class="q-text" value="${r[1]}" placeholder="Question">
                <div class="grid-2">
                    <input class="o1" value="${r[2]}" placeholder="Option 1">
                    <input class="o2" value="${r[3]}" placeholder="Option 2">
                    <input class="o3" value="${r[4]}" placeholder="Option 3">
                    <input class="o4" value="${r[5]}" placeholder="Option 4">
                </div>
                <div class="grid-2">
                    <label>Correct (1-4): <input type="number" class="correct" value="${r[6]}"></label>
                    <label>Mini Game: 
                        <select class="game-type">
                            <option value="memory" ${r[8]=='memory'?'selected':''}>Memory</option>
                            <option value="puzzle" ${r[8]=='puzzle'?'selected':''}>Puzzle</option>
                        </select>
                    </label>
                </div>
                <div style="background:#f9f9f9; padding:10px; margin-top:10px; border-radius:5px;">
                    <label><strong>Start Content:</strong></label>
                    <select class="media-type">
                        <option value="none" ${r[9]=='none'?'selected':''}>None</option>
                        <option value="video" ${r[9]=='video'?'selected':''}>Video (YouTube)</option>
                        <option value="pdf" ${r[9]=='pdf'?'selected':''}>PDF (Link)</option>
                        <option value="audio" ${r[9]=='audio'?'selected':''}>Audio (Link)</option>
                        <option value="tip" ${r[9]=='tip'?'selected':''}>Tip (Text)</option>
                    </select>
                    <input class="media-content" value="${r[10]}" placeholder="Paste Link or Tip Text here">
                </div>
            </div>`;
        });
    }

    function saveData() {
        const rows = [];
        document.querySelectorAll('.admin-row').forEach((div, i) => {
            rows.push([
                i+1,
                div.querySelector('.q-text').value,
                div.querySelector('.o1').value, div.querySelector('.o2').value,
                div.querySelector('.o3').value, div.querySelector('.o4').value,
                div.querySelector('.correct').value,
                div.querySelector('.is-active').checked,
                div.querySelector('.game-type').value,
                div.querySelector('.media-type').value,
                div.querySelector('.media-content').value
            ]);
        });
        
        fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'adminSave', pass: currentPass, rows }) })
        .then(r => r.json()).then(d => alert("Saved Successfully!"));
    }
</script>
</body>
</html>